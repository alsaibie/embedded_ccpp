<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/embedded_ccpp/libs/highlight/github.min.css"> <link rel=stylesheet  href="/embedded_ccpp/css/franklin.css"> <link rel=stylesheet  href="/embedded_ccpp/css/poole_hyde.css"> <link rel=stylesheet  href="/embedded_ccpp/css/custom.css"> <style> html {font-size: 17px;} .franklin-content {position: relative; padding-left: 8%; padding-right: 5%; line-height: 1.35em;} @media (min-width: 940px) { .franklin-content {width: 100%; margin-left: auto; margin-right: auto;} } @media (max-width: 968px) { .franklin-content {padding-left: 6%; padding-right: 6%;} } </style> <link rel=icon  href="/embedded_ccpp/assets/c.svg"> <title>I Fundamentals - Pointers and References</title> <div class=sidebar > <div class="container sidebar-sticky"> <div class=sidebar-about > <br> <img src="/embedded_ccpp/assets/KuwaitUniversityLogoTextLight.svg" style="width: 200px; height: auto; display: inline"> <h1 style="font-size:2em; opacity: 0.75;"><a href="/embedded_ccpp/">C/C++</a></h1> <p class=lead >Introduction to Embedded C/C++</p> </div> <script> function hidePart(part_div) { var x = document.getElementById(part_div); if (x.style.display === "none") { x.style.display = "block"; } else { x.style.display = "none"; } } </script> <nav class=sidebar-nav > <a class="sidebar-nav-item " href="/embedded_ccpp/">Home</a> <a class="sidebar-nav-item " href="https://alsaibie.github.io/me319">ME319 Mechatronics Course</a> <br> <small style="text-transform: uppercase; font-size: 0.75em">Lessons</small> <div class=part  onclick="hidePart('part1_div')">Fundamentals</div> <div id=part1_div  style="display:none;"> <a class="sidebar-nav-item " href="/embedded_ccpp/part_i/Introduction/"><b>L0</b> <em>Introduction</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_i/lesson1/"><b>L1</b> <em>C and C++</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_i/lesson2/"><b>L2</b> <em>File and Program Structure</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_i/lesson3/"><b>L3</b> <em>Data Types</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_i/lesson4/"><b>L4</b> <em>Variables</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_i/lesson5/"><b>L5</b> <em>Arrays</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_i/lesson6/"><b>L6</b> <em>Type Qualifiers and Storage Specifiers</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_i/lesson7/"><b>L7</b> <em>Operations</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_i/lesson8/"><b>L8</b> <em>Control Structures</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_i/lesson9/"><b>L9</b> <em>Functions</em></a> <a class="sidebar-nav-item active" href="/embedded_ccpp/part_i/lesson10/"><b>L10</b> <em>Pointers and References</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_i/lesson11/"><b>L11</b> <em>Structs</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_i/lesson12/"><b>L12</b> <em>Classes</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_i/lesson13/"><b>L13</b> <em>Strings</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_i/lesson14/"><b>L14</b> <em>Preprocessor Directives</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_i/lesson15/"><b>L15</b> <em>Standard Library</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_i/lesson16/"><b>L16</b> <em>C/C++ Process Flow</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_i/lesson17/"><b>L17</b> <em>Debugging</em></a> </div> <div class=part  onclick="hidePart('part2_div')">Embedded Applications</div> <div id=part2_div  style="display:none;"> <a class="sidebar-nav-item " href="/embedded_ccpp/part_ii/lesson1/"><b>L1</b> <em>Event-Drive Programming</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_ii/lesson2/"><b>L2</b> <em>Threads</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_ii/lesson3/"><b>L3</b> <em>Interrupts</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_ii/lesson3/"><b>L4</b> <em>Scheduling</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_ii/lesson3/"><b>L5</b> <em>Real-Time Control</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_ii/lesson3/"><b>L6</b> <em>Filters and Digital Controllers</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_ii/lesson3/"><b>L7</b> <em>Object-Oriented Device Libraries</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_ii/lesson3/"><b>L8</b> <em>State-Machine</em></a> </div> <div class=part  onclick="hidePart('part3_div')">Code Optimization</div> <div id=part3_div  style="display:none;"> <a class="sidebar-nav-item " href="/embedded_ccpp/part_iii/lesson1/"><b>L1</b> <em>Variable Sizes</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_iii/lesson2/"><b>L2</b> <em>Probabilistic Priority</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_iii/lesson3/"><b>L3</b> <em>Jumps and Branches</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_iii/lesson4/"><b>L4</b> <em>Loop Jamming</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_iii/lesson4/"><b>L5</b> <em>Integer vs. Floating Point Math</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_iii/lesson4/"><b>L6</b> <em>Pass by Reference</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_iii/lesson4/"><b>L7</b> <em>Reduce Expensive Math</em></a> </div> <!-- <div class=part  onclick="hidePart('part4_div')">Arduino API</div> <div id=part4_div  style="display:none;"> <a class="sidebar-nav-item {{ispage /part_iv/lesson1/}}active{{end}}" href="/embedded_ccpp/part_iv/lesson1/"><b>L1</b> <em>Overview</em></a> <a class="sidebar-nav-item {{ispage /part_iv/lesson2/}}active{{end}}" href="/embedded_ccpp/part_iv/lesson2/"><b>L2</b> <em>Program Structure</em></a> <a class="sidebar-nav-item {{ispage /part_iv/lesson3/}}active{{end}}" href="/embedded_ccpp/part_iv/lesson3/"><b>L3</b> <em>Blinky Example</em></a> <a class="sidebar-nav-item {{ispage /part_iv/lesson4/}}active{{end}}" href="/embedded_ccpp/part_iv/lesson4/"><b>L4</b> <em>Input Output Example</em></a> <a class="sidebar-nav-item {{ispage /part_iv/lesson5/}}active{{end}}" href="/embedded_ccpp/part_iv/lesson5/"><b>L5</b> <em>Arduino Library</em></a> <a class="sidebar-nav-item {{ispage /part_iv/lesson6/}}active{{end}}" href="/embedded_ccpp/part_iv/lesson6/"><b>L6</b> <em>Custom Library</em></a> </div> --> <!-- <small style="text-transform: uppercase; font-size: 0.75em">Tutorials</small> <div class=part  onclick="hidePart('vscode_setup_div')">VSCode Setup</div> <div id=vscode_setup_div  style="display:none;"> <a class="sidebar-nav-item {{ispage /vscode_setup/host/}}active{{end}}" href="/embedded_ccpp/vscode_setup/host/"> <em>Compile for Host</em></a> <a class="sidebar-nav-item {{ispage /vscode_setup/platformio/}}active{{end}}" href="/embedded_ccpp/vscode_setup/platformio/"> <em>Platform-IO</em></a> </div> --> </nav> <p>&copy; Ali AlSaibie, PhD.</p> </div> </div> <div class="content container"> <div class=franklin-content ><h1 id=pointers_and_references ><a href="#pointers_and_references" class=header-anchor >Pointers and References</a></h1> <p> <center><iframe title=vimeo-player  src="https://player.vimeo.com/video/387520687" width=640  height=370  frameborder=0  allowfullscreen></iframe></center> <br> The subject of pointers usually deters students away. It is indeed tricky to grasp at first, but understanding it is essential when working with embedded systems. </p> <p>By definition, a pointer can be considered a variable, but instead of storing a value, its purpose is to store an address of something.</p> <p>A pointer can store the address of a variable, a function, a struct. Basically any element of the C/C&#43;&#43; language. If something has an address, a pointer can be used to “POINT” to the location of this thing.</p> <p>We use the ampersand operator to express the address of a variable. </p> <p>When declaring a pointer, we use the star symbol to denote that, what we are declaring, is a pointer. </p> <p>When we want to access the value of the pointer, we access the pointer directly just like a variable. Again, the pointer will give as an address.</p> <p>If we want to retrieve the value stored in the address, of what the pointer is pointing TO, then we use the dereference operator *. </p> <p>So, heads-up, the star symbol is used in two different situations with pointers, in declaring a pointer and in DE-referencing a pointer.</p> <h2 id=operation_on_pointers ><a href="#operation_on_pointers" class=header-anchor >Operation on Pointers</a></h2> <ul> <li><p><strong>Declaration: e.g. uint8_t *ptr;</strong></p> <p>To declare a pointer, we specify the data type of the element the pointer will point to &#40;store the address of&#41;. Note how we add the star symbol to denote that ptr is a pointer type variable.</p> <li><p><strong>Assignment: e.g. ptr&#61;&x; ptr&#61;array</strong></p> <p>If x is a regular 8bit unsigned integer, and we want to store the address of x in ptr, we use the ampersand symbol a.k.a the reference operator. Note that the NAME of an array is a pointer to the first element of the array.</p> <li><p><strong>Dereference: e.g. *ptr</strong></p> <p>To retrieve the value in the address location stored in the pointer. We use the star symbol to DEREFERENCE the pointer. Here / we retrieve the value in X / if ptr stores the address of X.</p> <li><p><strong>Address of: e.g. &amp;x</strong></p> <p>Again, the ampersand symbol is called the reference operator, it gives us Not the value in x, but the address of x.</p> <li><p><strong>Increment: e.g. ptr&#43;&#61;3</strong></p> <li><p><strong>Decrement: e.g. ptr–</strong></p> <p>We can increment and decrement pointers just like regular variables. But note that the amount of increment or decrement is multiples of the address size of the pointer data type. </p> <li><p><strong>Difference: e.g. ptr1-ptr2</strong> </p> <p>We can subtract addresses</p> <li><p><strong>Comparison: e.g. ptr1&lt;ptr2, ptr1&#61;&#61;ptr2, etc.</strong></p> <p>We can compare addresses</p> </ul> <p><pre><code class="cpp hljs"><span class=hljs-meta >#<span class=hljs-meta-keyword >include</span> <span class=hljs-meta-string >&lt;iostream&gt;</span></span>

<span class=hljs-function ><span class=hljs-keyword >int</span> <span class=hljs-title >main</span><span class=hljs-params >(<span class=hljs-keyword >int</span> argc, <span class=hljs-keyword >char</span> *argv[])</span></span>{
    <span class=hljs-keyword >int</span> a = <span class=hljs-number >3</span>;
    <span class=hljs-keyword >int</span> *ptr = &amp;a; <span class=hljs-comment >/* initializing a variable with a * (star) prefix, declares it a pointer */</span>
    
    std::cout &lt;&lt; a &lt;&lt; std::endl; <span class=hljs-comment >/* Output: 3*/</span>
    std::cout &lt;&lt; ptr &lt;&lt; std::endl; <span class=hljs-comment >/* Output: 0x64E24FF7F0 (some random hex value) */</span>
    <span class=hljs-comment >/* derefrencing the ptr retrieves the value stored in the address pointed to by the pointer */</span>
    std::cout &lt;&lt; *ptr &lt;&lt; std::endl; <span class=hljs-comment >/* Output: 3, the * (star) prefix derefrences a pointer */</span>
    <span class=hljs-keyword >return</span> <span class=hljs-number >0</span>;
}</code></pre> <pre><code class="plaintext hljs">3
0x65fe1c
3
</code></pre></p> <p>&#91;L1&#93; Here we create a regular variable;</p> <p>&#91;L2&#93; Then we create a pointer. The star symbol tells the compiler that this is a pointer. We define the ptr by assigning the address of the variable a, by using the reference operator.</p> <p>&#91;L3&#93; When we print out the content of ptr, we will get a long hex number denoting an address in memory. On a PC. This will generally be a different number every time you compile and run the program.</p> <p>&#91;L4&#93; To print the content in the address inside ptr we use the star symbol to DEREFERENCE the ptr. We will basically get the value stored in the variable a </p> <h2 id=pointer_is_a_variable ><a href="#pointer_is_a_variable" class=header-anchor >Pointer is a variable</a></h2> <p><pre><code class="cpp hljs"><span class=hljs-meta >#<span class=hljs-meta-keyword >include</span> <span class=hljs-meta-string >&lt;iostream&gt;</span></span>
<span class=hljs-keyword >using</span> <span class=hljs-keyword >namespace</span> std;

<span class=hljs-function ><span class=hljs-keyword >int</span> <span class=hljs-title >main</span><span class=hljs-params >(<span class=hljs-keyword >int</span> argc, <span class=hljs-keyword >char</span> *argv[])</span></span>{
    <span class=hljs-keyword >int</span> x = <span class=hljs-number >1</span>; <span class=hljs-keyword >int</span> y = <span class=hljs-number >2</span>; <span class=hljs-keyword >int</span> *ptr;

    ptr = &amp;x; <span class=hljs-comment >/* Grabs the address of the variable x */</span>
    cout &lt;&lt; ptr &lt;&lt; endl;<span class=hljs-comment >/* Output: address of x */</span>

    y = *ptr; <span class=hljs-comment >/* Grabs the value in the address pointed to by ptr = value in x */</span>
    cout &lt;&lt; y &lt;&lt; endl;  <span class=hljs-comment >/* Output: 1 */</span>

    x = (<span class=hljs-keyword >int</span>)ptr; <span class=hljs-comment >/* Grabs address pointed to by ptr and stores it in x */</span>
    cout &lt;&lt; hex &lt;&lt; x &lt;&lt; endl; <span class=hljs-comment >/* Output: address of x as well */</span>

    *ptr = <span class=hljs-number >4</span>; <span class=hljs-comment >/* Changes the value stored in the location pointed to by ptr, changes the value of x */</span>
    cout &lt;&lt; x &lt;&lt; endl; <span class=hljs-comment >/*Output: 4 */</span>
    <span class=hljs-keyword >return</span> <span class=hljs-number >0</span>;
}</code></pre> <pre><code class="plaintext hljs">9
10
</code></pre></p> <p>&#91;L1&#93; A pointer is a variable. We can do assignment and we can do math on it.</p> <p>&#91;L2&#93; Here, we assign to y, the value stored in x by dereferencing the address of x.</p> <p>&#91;L3&#93; Here we store in x, the address of x. So X stores the address of itself. </p> <p>&#91;L4&#93; We can also change the value of x, by using the pointer. Since the pointer holds the address of x, we dereference ptr and assign a value to it. </p> <h2 id=incrementing_pointers ><a href="#incrementing_pointers" class=header-anchor >Incrementing Pointers</a></h2> <p>When incrementing a pointer, it will not necessarily be incremented by one. Instead, it will be incremented by the number of bytes of the data type it points to. <pre><code class="cpp hljs"><span class=hljs-meta >#<span class=hljs-meta-keyword >include</span> <span class=hljs-meta-string >&lt;iostream&gt;</span></span>

<span class=hljs-function ><span class=hljs-keyword >int</span> <span class=hljs-title >main</span><span class=hljs-params >(<span class=hljs-keyword >int</span> argc, <span class=hljs-keyword >char</span> *argv[])</span></span>{
    <span class=hljs-keyword >uint16_t</span> a = <span class=hljs-number >3</span>;
    <span class=hljs-keyword >uint32_t</span> b = <span class=hljs-number >3</span>;
    <span class=hljs-keyword >uint16_t</span> *ptr_a = &amp;a; 
    <span class=hljs-keyword >uint32_t</span> *ptr_b = &amp;b;

    std::cout &lt;&lt; ptr_a &lt;&lt; <span class=hljs-string >&quot;, &quot;</span> &lt;&lt; (++ptr_a) &lt;&lt; std::endl; <span class=hljs-comment >/* Ptr_a incremented by 2&#x27;  */</span>
    std::cout &lt;&lt; ptr_b &lt;&lt; <span class=hljs-string >&quot;, &quot;</span> &lt;&lt; (++ptr_b) &lt;&lt; std::endl; <span class=hljs-comment >/* Ptr_b incremented by 4&#x27;  */</span>
    <span class=hljs-keyword >return</span> <span class=hljs-number >0</span>;
}</code></pre> <pre><code class="plaintext hljs">0x65fe0a, 0x65fe0c
0x65fe0c, 0x65fe10
</code></pre></p> <p>For example, here we have two pointers: one for a 16bit variable and one for a 32bit.</p> <p>Now assuming we have 8-bit memory mapping, Meaning, every address points to an 8bit memory slot.</p> <p>When we increment the 16bit pointer, we jump two addresses. And when we increment the 32bit pointer, we jump 4 addresses. 8 to C in hex, that’s 4 decimal values.</p> <h2 id=arrays_vs_pointers ><a href="#arrays_vs_pointers" class=header-anchor >Arrays vs. Pointers</a></h2> <p>Arrays and pointers are closely related. </p> <p><pre><code class="cpp hljs"><span class=hljs-meta >#<span class=hljs-meta-keyword >include</span> <span class=hljs-meta-string >&lt;iostream&gt;</span></span>
<span class=hljs-keyword >using</span> <span class=hljs-keyword >namespace</span> std;

<span class=hljs-function ><span class=hljs-keyword >int</span> <span class=hljs-title >main</span><span class=hljs-params >(<span class=hljs-keyword >int</span> argc, <span class=hljs-keyword >char</span> *argv[])</span></span>{
    <span class=hljs-keyword >uint16_t</span> sequence[<span class=hljs-number >5</span>] = {<span class=hljs-number >2</span>,<span class=hljs-number >4</span>,<span class=hljs-number >6</span>,<span class=hljs-number >8</span>,<span class=hljs-number >16</span>};

    cout &lt;&lt; sequence[<span class=hljs-number >0</span>] &lt;&lt; endl; <span class=hljs-comment >/* Output: 2 */</span>
    cout &lt;&lt; sequence    &lt;&lt; endl; <span class=hljs-comment >/* Output: a hex address */</span>
    cout &lt;&lt; *(sequence + <span class=hljs-number >2</span>) &lt;&lt; endl; <span class=hljs-comment >/*Output: 6, retrieving the 3rd array element */</span>
    
    <span class=hljs-keyword >return</span> <span class=hljs-number >0</span>;
}</code></pre> <pre><code class="plaintext hljs">2
0x65fe16
6
</code></pre></p> <p>You can probably see that an array stores a sequence of values of similar data types; the array name is actually a pointer, pointing to the first element of the array.</p> <p>You can actually treat the array name as a pointer. </p> <p>&#91;Last&#93; Here we increment the pointer &#40;the name of the array&#41; by two, then dereference it. This wiill retrieve the 3rd array element.</p> <h2 id=passing_pointers ><a href="#passing_pointers" class=header-anchor >Passing Pointers</a></h2> <p>The strength of pointers is seen in one example by the way data can be passed between functions. </p> <p><pre><code class="cpp hljs"><span class=hljs-meta >#<span class=hljs-meta-keyword >include</span> <span class=hljs-meta-string >&lt;iostream&gt;</span></span>
<span class=hljs-keyword >using</span> <span class=hljs-keyword >namespace</span> std;

<span class=hljs-comment >/* A function accepts a ptr, a ptr is just a variable */</span>
<span class=hljs-function ><span class=hljs-keyword >void</span> <span class=hljs-title >sum_array</span><span class=hljs-params >(<span class=hljs-keyword >uint8_t</span> *arr, <span class=hljs-keyword >size_t</span> arr_s, <span class=hljs-keyword >uint16_t</span> *sum_ptr)</span></span>;

<span class=hljs-function ><span class=hljs-keyword >int</span> <span class=hljs-title >main</span><span class=hljs-params >(<span class=hljs-keyword >int</span> argc, <span class=hljs-keyword >char</span> *argv[])</span></span>{
    <span class=hljs-keyword >uint8_t</span> sequence[<span class=hljs-number >4</span>] = {<span class=hljs-number >2</span>, <span class=hljs-number >3</span>, <span class=hljs-number >4</span>, <span class=hljs-number >1</span>};
    <span class=hljs-keyword >uint16_t</span> sum = <span class=hljs-number >0</span>; 
    <span class=hljs-comment >/* When passing an array, need to pass size of array */</span>
    <span class=hljs-built_in >sum_array</span>(sequence,<span class=hljs-built_in ><span class=hljs-keyword >sizeof</span></span>(sequence), &amp;sum);
    cout &lt;&lt; sum &lt;&lt; endl;
    <span class=hljs-keyword >return</span> <span class=hljs-number >0</span>;
}

<span class=hljs-function ><span class=hljs-keyword >void</span> <span class=hljs-title >sum_array</span><span class=hljs-params >(<span class=hljs-keyword >uint8_t</span> *arr, <span class=hljs-keyword >size_t</span> arr_s, <span class=hljs-keyword >uint16_t</span> *sum_ptr)</span></span>{
    <span class=hljs-keyword >for</span> (<span class=hljs-keyword >int</span> k = <span class=hljs-number >0</span>; k &lt; arr_s; k++){
        *sum_ptr += arr[k]; <span class=hljs-comment >/* The original variable is manipulated */</span>
    }
}</code></pre> <pre><code class="plaintext hljs">10
</code></pre></p> <p>When passing a variable to a function the usual way, what is passed is a copy of the variable. That’s extra time and memory consumed. </p> <p>Instead of passing a COPY of the variable, we can pass the address of the variable. So the function can manipulate the original variable directly.</p> <p>This efficient data handling is shown better when dealing with arrays. Instead of passing a COPY of all array elements, we can pass a pointer to the array and let the function manipulate the array directly.</p> <p>Note that arrays does not carry information regarding their size or length. So, along with the array name &#40;which is a pointer&#41;, we have to tell the function the size of the array.</p> <p>In C&#43;&#43;, there are however other advanced ways to store sequences of data using standard library templates such as lists, maps and vectors. That carry more information about themselves.</p> <p>&#91;L1&#93; In this example, we have a function that sums array elements. It takes a pointer to the array, the size of the array and a ptr to the result variable.</p> <p>&#91;L2&#93; Here we create the array, and a result variable. When calling the function, we pass the array name; which is a ptr, the size of the array and the address of the result variable.</p> <p>&#91;L3&#93; inside the function, we loop through the array elements and continue adding the values to the result variable. Note that sum_ptr is a pointer, so to manipulate the result variable we have to dereference it.</p> <p>Next: <a href="../lesson11/">Structs</a></p> <div class=page-foot > <div class=copyright > &copy; Ali AlSaibie, PhD. Last modified: April 02, 2021. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>. </div> </div> </div> </div> <script src="/embedded_ccpp/libs/highlight/highlightjs-line-numbers.js"></script>