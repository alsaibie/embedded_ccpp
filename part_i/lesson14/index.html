<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/embedded_ccpp/libs/highlight/github.min.css"> <link rel=stylesheet  href="/embedded_ccpp/css/franklin.css"> <link rel=stylesheet  href="/embedded_ccpp/css/poole_hyde.css"> <link rel=stylesheet  href="/embedded_ccpp/css/custom.css"> <style> html {font-size: 17px;} .franklin-content {position: relative; padding-left: 8%; padding-right: 5%; line-height: 1.35em;} @media (min-width: 940px) { .franklin-content {width: 100%; margin-left: auto; margin-right: auto;} } @media (max-width: 968px) { .franklin-content {padding-left: 6%; padding-right: 6%;} } </style> <link rel=icon  href="/embedded_ccpp/assets/c.svg"> <title>I Fundamentals - Preprocessor Directives</title> <div class=sidebar > <div class="container sidebar-sticky"> <div class=sidebar-about > <br> <img src="/embedded_ccpp/assets/KuwaitUniversityLogoTextLight.svg" style="width: 200px; height: auto; display: inline"> <h1 style="font-size:2em; opacity: 0.75;"><a href="/embedded_ccpp/">C/C++</a></h1> <p class=lead >Introduction to Embedded C/C++</p> </div> <script> function hidePart(part_div) { var x = document.getElementById(part_div); if (x.style.display === "none") { x.style.display = "block"; } else { x.style.display = "none"; } } </script> <nav class=sidebar-nav > <a class="sidebar-nav-item " href="/embedded_ccpp/">Home</a> <a class="sidebar-nav-item " href="https://alsaibie.github.io/me319">ME319 Mechatronics Course</a> <br> <small style="text-transform: uppercase; font-size: 0.75em">Lessons</small> <div class=part  onclick="hidePart('part1_div')">Fundamentals</div> <div id=part1_div  style="display:none;"> <a class="sidebar-nav-item " href="/embedded_ccpp/part_i/introduction/"><b>L0</b> <em>Introduction</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_i/lesson1/"><b>L1</b> <em>C and C++</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_i/lesson2/"><b>L2</b> <em>File and Program Structure</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_i/lesson3/"><b>L3</b> <em>Data Types</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_i/lesson4/"><b>L4</b> <em>Variables</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_i/lesson5/"><b>L5</b> <em>Arrays</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_i/lesson6/"><b>L6</b> <em>Type Qualifiers and Storage Specifiers</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_i/lesson7/"><b>L7</b> <em>Operations</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_i/lesson8/"><b>L8</b> <em>Control Structures</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_i/lesson9/"><b>L9</b> <em>Functions</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_i/lesson10/"><b>L10</b> <em>Pointers and References</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_i/lesson11/"><b>L11</b> <em>Structs</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_i/lesson12/"><b>L12</b> <em>Classes</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_i/lesson13/"><b>L13</b> <em>Strings</em></a> <a class="sidebar-nav-item active" href="/embedded_ccpp/part_i/lesson14/"><b>L14</b> <em>Preprocessor Directives</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_i/lesson15/"><b>L15</b> <em>Standard Library</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_i/lesson16/"><b>L16</b> <em>C/C++ Process Flow</em></a> <a class="sidebar-nav-item " href="/embedded_ccpp/part_i/lesson17/"><b>L17</b> <em>Debugging</em></a> </div> <!-- <div class=part  onclick="hidePart('part2_div')">Embedded Applications</div> <div id=part2_div  style="display:none;"> <a class="sidebar-nav-item {{ispage /part_ii/lesson1/}}active{{end}}" href="/embedded_ccpp/part_ii/lesson1/"><b>L1</b> <em>Event-Drive Programming</em></a> <a class="sidebar-nav-item {{ispage /part_ii/lesson2/}}active{{end}}" href="/embedded_ccpp/part_ii/lesson2/"><b>L2</b> <em>Threads</em></a> <a class="sidebar-nav-item {{ispage /part_ii/lesson3/}}active{{end}}" href="/embedded_ccpp/part_ii/lesson3/"><b>L3</b> <em>Interrupts</em></a> <a class="sidebar-nav-item {{ispage /part_ii/lesson3/}}active{{end}}" href="/embedded_ccpp/part_ii/lesson3/"><b>L4</b> <em>Scheduling</em></a> <a class="sidebar-nav-item {{ispage /part_ii/lesson3/}}active{{end}}" href="/embedded_ccpp/part_ii/lesson3/"><b>L5</b> <em>Real-Time Control</em></a> <a class="sidebar-nav-item {{ispage /part_ii/lesson3/}}active{{end}}" href="/embedded_ccpp/part_ii/lesson3/"><b>L6</b> <em>Filters and Digital Controllers</em></a> <a class="sidebar-nav-item {{ispage /part_ii/lesson3/}}active{{end}}" href="/embedded_ccpp/part_ii/lesson3/"><b>L7</b> <em>Object-Oriented Device Libraries</em></a> <a class="sidebar-nav-item {{ispage /part_ii/lesson3/}}active{{end}}" href="/embedded_ccpp/part_ii/lesson3/"><b>L8</b> <em>State-Machine</em></a> </div> <div class=part  onclick="hidePart('part3_div')">Code Optimization</div> <div id=part3_div  style="display:none;"> <a class="sidebar-nav-item {{ispage /part_iii/lesson1/}}active{{end}}" href="/embedded_ccpp/part_iii/lesson1/"><b>L1</b> <em>Variable Sizes</em></a> <a class="sidebar-nav-item {{ispage /part_iii/lesson2/}}active{{end}}" href="/embedded_ccpp/part_iii/lesson2/"><b>L2</b> <em>Probabilistic Priority</em></a> <a class="sidebar-nav-item {{ispage /part_iii/lesson3/}}active{{end}}" href="/embedded_ccpp/part_iii/lesson3/"><b>L3</b> <em>Jumps and Branches</em></a> <a class="sidebar-nav-item {{ispage /part_iii/lesson4/}}active{{end}}" href="/embedded_ccpp/part_iii/lesson4/"><b>L4</b> <em>Loop Jamming</em></a> <a class="sidebar-nav-item {{ispage /part_iii/lesson4/}}active{{end}}" href="/embedded_ccpp/part_iii/lesson4/"><b>L5</b> <em>Integer vs. Floating Point Math</em></a> <a class="sidebar-nav-item {{ispage /part_iii/lesson4/}}active{{end}}" href="/embedded_ccpp/part_iii/lesson4/"><b>L6</b> <em>Pass by Reference</em></a> <a class="sidebar-nav-item {{ispage /part_iii/lesson4/}}active{{end}}" href="/embedded_ccpp/part_iii/lesson4/"><b>L7</b> <em>Reduce Expensive Math</em></a> </div> --> <!-- <div class=part  onclick="hidePart('part4_div')">Arduino API</div> <div id=part4_div  style="display:none;"> <a class="sidebar-nav-item {{ispage /part_iv/lesson1/}}active{{end}}" href="/embedded_ccpp/part_iv/lesson1/"><b>L1</b> <em>Overview</em></a> <a class="sidebar-nav-item {{ispage /part_iv/lesson2/}}active{{end}}" href="/embedded_ccpp/part_iv/lesson2/"><b>L2</b> <em>Program Structure</em></a> <a class="sidebar-nav-item {{ispage /part_iv/lesson3/}}active{{end}}" href="/embedded_ccpp/part_iv/lesson3/"><b>L3</b> <em>Blinky Example</em></a> <a class="sidebar-nav-item {{ispage /part_iv/lesson4/}}active{{end}}" href="/embedded_ccpp/part_iv/lesson4/"><b>L4</b> <em>Input Output Example</em></a> <a class="sidebar-nav-item {{ispage /part_iv/lesson5/}}active{{end}}" href="/embedded_ccpp/part_iv/lesson5/"><b>L5</b> <em>Arduino Library</em></a> <a class="sidebar-nav-item {{ispage /part_iv/lesson6/}}active{{end}}" href="/embedded_ccpp/part_iv/lesson6/"><b>L6</b> <em>Custom Library</em></a> </div> --> <!-- <small style="text-transform: uppercase; font-size: 0.75em">Tutorials</small> <div class=part  onclick="hidePart('vscode_setup_div')">VSCode Setup</div> <div id=vscode_setup_div  style="display:none;"> <a class="sidebar-nav-item {{ispage /vscode_setup/host/}}active{{end}}" href="/embedded_ccpp/vscode_setup/host/"> <em>Compile for Host</em></a> <a class="sidebar-nav-item {{ispage /vscode_setup/platformio/}}active{{end}}" href="/embedded_ccpp/vscode_setup/platformio/"> <em>Platform-IO</em></a> </div> --> </nav> <p>&copy; Ali AlSaibie, PhD.</p> </div> </div> <div class="content container"> <div class=franklin-content ><h1 id=preprocessor_directives ><a href="#preprocessor_directives" class=header-anchor >Preprocessor Directives</a></h1> <p>So what are the preprocessor directives?</p> <p>They are the instructions that begin with the hash sign <code>#</code>. When you Build the program, the preprocessor scans through the source files and executes the preprocessor directives. then the code is compiled. The core compiler doesn&#39;t see the commands that begin with <code>#</code>, they are resolved beforehand. </p> <p>There are a handful of preprocessor directives. We will review Macro definitions, conditional inclusions and header file inclusions. </p> <p>Preprocessor Directives are lines in the code of the program preceded by a hash sign <code>#</code></p> <p>They are not part of the compiled program. They are executed during building of the program, in the preprocessor step. They include:</p> <ul> <li><p>Macro definitions &#40;#define, #undef&#41;</p> <li><p>Conditional inclusions &#40;<code>#ifdef</code>, <code>#ifndef</code>, <code>#if</code>, <code>#endif</code>, <code>#else</code> and <code>#elif</code>&#41;</p> <li><p>Line control &#40;<code>#line</code>&#41;</p> <li><p>Error directive &#40;<code>#error</code>&#41;</p> <li><p>Header file inclusion &#40;<code>#include</code>&#41;</p> <li><p>Pragma directive &#40;<code>#pragma</code>&#41;</p> </ul> <h2 id=macros ><a href="#macros" class=header-anchor >Macros</a></h2> <p>Macros are a handy way of creating an alias for a C/C&#43;&#43; piece of instruction. </p> <pre><code class="cpp hljs"><span class=hljs-meta >#<span class=hljs-meta-keyword >include</span> <span class=hljs-meta-string >&lt;cstdint&gt;</span></span>
<span class=hljs-meta >#<span class=hljs-meta-keyword >include</span> <span class=hljs-meta-string >&lt;iostream&gt;</span></span>

<span class=hljs-meta >#<span class=hljs-meta-keyword >define</span> PI 3.1416f    <span class=hljs-comment >/* Can be used to define constants */</span></span>
<span class=hljs-meta >#<span class=hljs-meta-keyword >define</span> GPS_ENABLED 1 <span class=hljs-comment >/* Can be used as a global to enable/disable subroutines */</span></span>
<span class=hljs-meta >#<span class=hljs-meta-keyword >define</span> FIRMWARE_V 4  <span class=hljs-comment >/* Can be used to denote version of hardware  software */</span></span>
<span class=hljs-meta >#<span class=hljs-meta-keyword >define</span> DEBUG 0</span>
<span class=hljs-meta >#<span class=hljs-meta-keyword >define</span> RAD2D(x) x * 180.0 / PI <span class=hljs-comment >/* A Macro can be function-like, taking &amp; pro-cessing an argument */</span></span>

<span class=hljs-function ><span class=hljs-keyword >void</span> <span class=hljs-title >update_gps</span><span class=hljs-params >()</span> </span>{}
<span class=hljs-function ><span class=hljs-keyword >void</span> <span class=hljs-title >update_gps_2</span><span class=hljs-params >()</span> </span>{}

<span class=hljs-function ><span class=hljs-keyword >int</span> <span class=hljs-title >main</span><span class=hljs-params >(<span class=hljs-keyword >int</span> argc, <span class=hljs-keyword >char</span> *argv[])</span>
</span>{
    <span class=hljs-keyword >float</span> rad = <span class=hljs-number >0.1</span>;
    <span class=hljs-keyword >float</span> circumference = <span class=hljs-number >2</span> * PI * rad; <span class=hljs-comment >/* Useful instead of writing 3.1416 every time */</span>
    <span class=hljs-keyword >if</span> (GPS_ENABLED)
    {
        <span class=hljs-built_in >update_gps</span>();
    }
    <span class=hljs-keyword >if</span> (FIRMWARE_V &gt; <span class=hljs-number >2</span>)
    {
        <span class=hljs-built_in >update_gps_2</span>();
    }
    <span class=hljs-keyword >if</span> (DEBUG)
    {
        std::cout &lt;&lt; <span class=hljs-string >&quot;Log Message&quot;</span> &lt;&lt; std::endl;
    }
    <span class=hljs-keyword >return</span> <span class=hljs-number >0</span>;
}</code></pre> <p>To use the macro definitions. We include the <code>#define</code> keyword, the macro definition and then what it stands for. </p> <p>You will often find macro definitions used in place of some flags, numbers, version number. And then can also be function like where they take and process an argument. </p> <p>Note that the preprocessor executes these commands. The compiler will not see the macro definitions. </p> <p>For example, PI is macro defined as 3.1416, The preprocessor will look for all instances of the word PI in the code and replace it with 3.1416 BEFORE the code is compiled. </p> <p>Here we define a function macro to convert rad to degrees. When used in code, the preprocessor will replace RAD2D&#40;PI/2&#41; for example to 1.5 * 180 / pi. This is not a function, but a command that will be substituted in the code whenever the macro <code>RAD2D&#40;x&#41;</code></p> <pre><code class="cpp hljs"><span class=hljs-meta >#<span class=hljs-meta-keyword >define</span> RAD2D(x) x * 180.0 / PI</span></code></pre>
<h2 id=conditional_inclusions ><a href="#conditional_inclusions" class=header-anchor >Conditional Inclusions</a></h2>
<p>The preprocessor can perform a conditional if statement. </p>
<p><pre><code class="cpp hljs"><span class=hljs-meta >#<span class=hljs-meta-keyword >include</span> <span class=hljs-meta-string >&lt;iostream&gt;</span></span>
<span class=hljs-keyword >using</span> <span class=hljs-keyword >namespace</span> std;

<span class=hljs-meta >#<span class=hljs-meta-keyword >define</span> FW_VER 2 <span class=hljs-comment >/* We define some macro here, such as Firmware version */</span></span>

<span class=hljs-comment >/* Then we can define different functions / routines / objects etc. based on FW version*/</span>
<span class=hljs-meta >#<span class=hljs-meta-keyword >if</span>(FW_VER == 1)</span>
    <span class=hljs-meta >#<span class=hljs-meta-keyword >define</span> print_version() cout&lt;&lt;<span class=hljs-meta-string >&quot;Version 1&quot;</span> &lt;&lt;endl; </span>
<span class=hljs-meta >#<span class=hljs-meta-keyword >elif</span>(FW_VER == 2)</span>
    <span class=hljs-meta >#<span class=hljs-meta-keyword >define</span> print_version() cout&lt;&lt;<span class=hljs-meta-string >&quot;Version 2&quot;</span> &lt;&lt;endl;</span>
<span class=hljs-meta >#<span class=hljs-meta-keyword >endif</span></span>

<span class=hljs-function ><span class=hljs-keyword >int</span> <span class=hljs-title >main</span><span class=hljs-params >(<span class=hljs-keyword >int</span> argc, <span class=hljs-keyword >char</span> *argv[])</span></span>{
    <span class=hljs-built_in >print_version</span>(); <span class=hljs-comment >/* Output: Version 2 */</span>
    <span class=hljs-keyword >return</span> <span class=hljs-number >0</span>;
}</code></pre> <pre><code class="plaintext hljs">Version 2
</code></pre></p>
<p>The syntax would require a <code>#if</code> and a <code>#endif</code> at least, with as many <code>#elif</code> in between. </p>
<p>One example use is when you have a code that you want to be backward compatible with previous versions of hardware or firmware. </p>
<p>You can set a macro somewhere to define the version number of your hardware for example, and then use the conditional inclusions to determine which piece of code to execute, depending on the hardware version. </p>
<p>Note that only the true statement code will be compiled. Think of it as a way to filter and select between different sets of codes to compile based on some condition. There is no overhead during the code execution, since the condition is fixed at compile time and doesn&#39;t change during execution &#40;your drone hardware will not change midflight for instance, or maybe it will for some reason, that would be very creative&#41;.</p>
<h3 id=ifdef_ifndef ><a href="#ifdef_ifndef" class=header-anchor >Ifdef &amp; Ifndef</a></h3>
<p>In this example we define a macro FW_VER and set it to 2. Then we have conditional inclusion. </p>
<p><pre><code class="cpp hljs"><span class=hljs-meta >#<span class=hljs-meta-keyword >include</span> <span class=hljs-meta-string >&lt;iostream&gt;</span></span>
<span class=hljs-keyword >using</span> <span class=hljs-keyword >namespace</span> std;

<span class=hljs-meta >#<span class=hljs-meta-keyword >ifndef</span> FW_VER <span class=hljs-comment >/* We can check if a macro is undefined */</span></span>
    <span class=hljs-meta >#<span class=hljs-meta-keyword >define</span> FW_VER 1 </span>
<span class=hljs-meta >#<span class=hljs-meta-keyword >endif</span></span>

<span class=hljs-comment >/* Then we can define different functions / routines / objects etc. based on FW version*/</span>
<span class=hljs-meta >#<span class=hljs-meta-keyword >if</span>(FW_VER == 1)</span>
    <span class=hljs-meta >#<span class=hljs-meta-keyword >define</span> print_version() cout&lt;&lt;<span class=hljs-meta-string >&quot;Version 1&quot;</span> &lt;&lt;endl; </span>
<span class=hljs-meta >#<span class=hljs-meta-keyword >elif</span>(FW_VER == 2)</span>
    <span class=hljs-meta >#<span class=hljs-meta-keyword >define</span> print_version() cout&lt;&lt;<span class=hljs-meta-string >&quot;Version 2&quot;</span> &lt;&lt;endl;</span>
<span class=hljs-meta >#<span class=hljs-meta-keyword >endif</span></span>

<span class=hljs-function ><span class=hljs-keyword >int</span> <span class=hljs-title >main</span><span class=hljs-params >(<span class=hljs-keyword >int</span> argc, <span class=hljs-keyword >char</span> *argv[])</span></span>{
    <span class=hljs-built_in >print_version</span>(); <span class=hljs-comment >/* Output: Version 1 */</span>
    <span class=hljs-keyword >return</span> <span class=hljs-number >0</span>;
}</code></pre> <pre><code class="plaintext hljs">Version 1
</code></pre></p>
<p>Note that the second condition is true and the <code>print_version&#40;&#41;</code> macro is defined as the following. Again, the compile will not see these hash lines, in this example it will see <code>cout&lt;&lt;&quot;Version 1&quot; &lt;&lt;endl;</code> here instead of <code>print_version&#40;&#41;</code></p>
<p>Another useful macro is the <code>ifdef</code> and <code>ifndef</code> directives.  They can be used to check if a specific macro is defined or not defined. </p>
<pre><code class="cpp hljs"><span class=hljs-meta >#<span class=hljs-meta-keyword >ifndef</span> FW_VER <span class=hljs-comment >/* We can check if a macro is undefined */</span></span>
    <span class=hljs-meta >#<span class=hljs-meta-keyword >define</span> FW_VER 1 </span>
<span class=hljs-meta >#<span class=hljs-meta-keyword >endif</span></span></code></pre>
<p>Assume you have a conditional inclusion statement &#40;if elif&#41; that relies on a certain macro being defined. Perhaps if the header file where it should be defined in is not included. You might want to add a default value to it then, as shown in the example here. Which checks to see if FW_VER is defined, if it is not, then it defines it to some value. Perhaps this is a default value. </p>
<p>Note that a macro doesn’t have to have an equivalent code. We can simply macro define fw_ver without any associated code or value and the <code>ifdef</code> directive would still find it as valid. </p>
<pre><code class="cpp hljs"><span class=hljs-meta >#<span class=hljs-meta-keyword >define</span> FW_VER <span class=hljs-comment >/* This is sufficient to have FW_VER defined */</span></span>
<span class=hljs-meta >#<span class=hljs-meta-keyword >ifndef</span> FW_VER </span>
    <span class=hljs-meta >#<span class=hljs-meta-keyword >define</span> FW_VER 1 </span>
<span class=hljs-meta >#<span class=hljs-meta-keyword >endif</span></span></code></pre>
<h2 id=header_inclusion ><a href="#header_inclusion" class=header-anchor >Header Inclusion</a></h2>
<p>You have already seen this directive. </p>
<pre><code class="cpp hljs"><span class=hljs-comment >/* Quotes include looks for the header files in the working directory */</span>
<span class=hljs-meta >#<span class=hljs-meta-keyword >include</span> <span class=hljs-meta-string >&quot;my_header.h&quot;</span> </span>
<span class=hljs-comment >/* Angle brackets are generally used for system headers */</span>
<span class=hljs-meta >#<span class=hljs-meta-keyword >include</span> <span class=hljs-meta-string >&lt;system_header.h&gt;</span> </span>

<span class=hljs-function ><span class=hljs-keyword >int</span> <span class=hljs-title >main</span><span class=hljs-params >(<span class=hljs-keyword >int</span> argc, <span class=hljs-keyword >char</span> *argv[])</span></span>{
    <span class=hljs-built_in >some_function_from_my_header</span>();
    <span class=hljs-built_in >some_other_function_from_system_header</span>();
    <span class=hljs-keyword >return</span> <span class=hljs-number >0</span>;
}</code></pre>
<p>The include directive as the name implies, includes the content of the included file. You can picture the preprocessor taking all the content of the included header and dumping it in place of the include line. </p>
<p>When using the double quotes to include a header, the preprocessor looks for the header file in the same folder as or with respective to the folder location of the source file.</p>
<pre><code class="cpp hljs"><span class=hljs-comment >/* Quotes include looks for the header files in the working directory */</span>
<span class=hljs-meta >#<span class=hljs-meta-keyword >include</span> <span class=hljs-meta-string >&quot;my_header.h&quot;</span></span></code></pre>
<p>When using angled brackets to include a header file, the preprocessor looks for the header in the system lib include paths. The include paths would be specified to the compiler configuration file &#40;e.g. cmake, make, etc.&#41;</p>
<pre><code class="cpp hljs"><span class=hljs-comment >/* Angle brackets are generally used for system headers */</span>
<span class=hljs-meta >#<span class=hljs-meta-keyword >include</span> <span class=hljs-meta-string >&lt;system_header.h&gt;</span></span></code></pre>
<p>Next: <a href="../lesson15/">Standard Library</a></p>
<div class=page-foot >
  <div class=copyright >
    &copy; Ali AlSaibie, PhD. Last modified: April 03, 2021. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
  </div>
</div>
</div>
    </div>  
    
    
        
<script src="/embedded_ccpp/libs/highlight/highlightjs-line-numbers.js"></script>